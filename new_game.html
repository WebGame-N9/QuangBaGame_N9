<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Game: Danh Sách & Chỉnh Sửa (API Ready)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- CSS Tùy chỉnh và Nhúng -->
    <style>
        /* CSS Cấu hình chung */
        body {
            background-color: #1a1a2e;
            color: #fff;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }

        .main-wrapper {
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-title {
            color: #f7931e;
            font-size: 2.5em;
            padding-bottom: 10px;
            border-bottom: 3px solid #f7931e;
            display: inline-block;
        }

        /* --- Quản lý hiển thị các view --- */
        .view-container {
            display: none;
        }

        .view-container.active {
            display: block;
        }

        /* --- CSS cho DANH SÁCH (List View) --- */
        .list-header {
            max-width: 1200px;
            margin: 0 auto 30px auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 15px;
            background-color: #2a2a3a;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .management-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-add {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-add:hover {
            background-color: #45a049;
        }
        
        /* Game Grid */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .game-card {
            background-color: #2a2a3a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
        }

        .game-image img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
        }

        .game-content {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-title {
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 5px;
            color: #f7931e;
        }

        .game-category {
            font-size: 0.85em;
            color: #aaa;
            margin-bottom: 5px;
        }

        .game-rating {
            font-size: 0.9em;
            color: #ffd700;
        }

        .btn-edit {
            background-color: #5c67f2;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-edit:hover {
            background-color: #4a54e6;
        }
        
        /* --- CSS cho FORM (Form View) --- */
        .form-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
            background-color: #2a2a3a;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #d1d1e0;
        }

        .form-control,
        textarea.form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #1e1e2e;
            color: #fff;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        .form-control:focus,
        textarea.form-control:focus {
            border-color: #f7931e;
            outline: none;
        }
        
        .form-control[readonly] {
            background-color: #333;
            cursor: default;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #1e1e2e;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            accent-color: #f7931e;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .config-box {
            padding: 15px;
            border-radius: 8px;
            background-color: #1e1e2e;
        }

        .config-box h3 {
            margin-top: 0;
            color: #f7931e;
        }

        .section-title {
            color: #f7931e;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
        }
        
        .radio-group input[type="radio"] {
            accent-color: #f7931e;
        }

        .btn-submit {
            background-color: #f7931e;
            color: #1e1e2e;
            padding: 15px 25px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 30px;
        }

        .btn-submit:hover {
            background-color: #e08419;
        }
        
        .btn-back {
            background-color: #555;
            color: white;
        }
        .btn-back:hover {
            background-color: #777;
        }

        .btn-delete {
            background-color: #f44336;
            color: white;
            opacity: 0.5; 
            cursor: not-allowed;
        }
        .btn-delete.active:hover {
            background-color: #da190b;
        }
        .btn-delete.active {
            opacity: 1;
            cursor: pointer;
        }

        /* --- CSS cho MODAL TÙY CHỈNH --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #2a2a3a;
            color: #fff;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.9);
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-confirm-delete {
            background-color: #f44336;
            color: white;
        }
        .btn-confirm-delete:hover {
            background-color: #da190b;
        }

        .btn-cancel, .btn-ok {
            background-color: #5c67f2;
            color: white;
        }
        .btn-cancel:hover, .btn-ok:hover {
            background-color: #4a54e6;
        }

    </style>
</head>

<body>
    <div class="main-wrapper">
        <div class="header-section" data-aos="fade-down">
            <h1 class="header-title">QUẢN LÝ THÔNG TIN GAME</h1>
        </div>

        <!-- VIEW DANH SÁCH GAME -->
        <div id="listView" class="view-container active">
            <div class="list-header" data-aos="fade-up">
                <h2 style="margin: 0; color: #fff;">Danh Sách Game</h2>
                <div class="action-buttons">
                    <button class="management-btn btn-add" onclick="loadGameForm(null)">
                        <i class="fa-solid fa-plus"></i> Thêm Game Mới
                    </button>
                </div>
            </div>

            <div id="gameList" class="game-grid" data-aos="fade-up" data-aos-delay="100">
                <!-- Game Cards sẽ được render vào đây -->
                <p style="grid-column: 1 / -1; text-align: center;" id="loading-message">
                    <i class="fa-solid fa-spinner fa-spin"></i> Đang tải dữ liệu từ API...
                </p>
            </div>
            <div id="noResults" class="no-results" style="text-align: center; color: #ccc; margin-top: 30px; display: none;">
                <p>Không tìm thấy game nào.</p>
            </div>
        </div>
        
        <!-- VIEW FORM (THÊM/SỬA/XÓA) -->
        <div id="formView" class="view-container">
            <div class="management-toolbar">
                <button class="management-btn btn-back" onclick="switchView('list')">
                    <i class="fa-solid fa-arrow-left"></i> Quay lại Danh sách
                </button>
                <div class="action-buttons">
                    <button class="management-btn btn-delete" id="delete-game-btn" disabled>
                        <i class="fa-solid fa-trash"></i> Xóa Game
                    </button>
                </div>
            </div>

            <div class="form-container" data-aos="fade-up">
                 <h2 class="section-title" id="form-mode-title">CHỈNH SỬA GAME</h2>
                <form id="gameForm">
                    <h2 class="section-title">Thông tin cơ bản</h2>

                    <div class="form-group">
                        <label for="gameId">ID Game:</label>
                        <input type="number" id="gameId" name="id" class="form-control" readonly placeholder="ID sẽ được tự động điền khi sửa/thêm">
                        <small style="color: #ccc;">*ID Game (Chỉ đọc).</small>
                    </div>

                    <div class="form-group">
                        <label for="gameName">Tên Game:</label>
                        <input type="text" id="gameName" name="name" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="developer">Nhà phát triển:</label>
                        <input type="text" id="developer" name="developer" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="releaseDate">Ngày phát hành:</label>
                        <input type="text" id="releaseDate" name="releaseDate" class="form-control" placeholder="Ví dụ: 25/07/2017" required>
                    </div>

                    <div class="form-group">
                        <label for="officialWebsite">Trang chính thức (Link):</label>
                        <input type="url" id="officialWebsite" name="officialWebsite" class="form-control" placeholder="https://gameofficialsite.com">
                    </div>

                    <div class="form-group">
                        <label for="downloadText">Văn bản nút Tải (Download Text):</label>
                        <input type="text" id="downloadText" name="downloadText" class="form-control" placeholder="Ví dụ: ⬇ Tải Game Miễn Phí (PC/Mobile)">
                    </div>
                    
                    <div class="form-group">
                        <label for="rating">Đánh giá (Rating):</label>
                        <input type="number" id="rating" name="rating" class="form-control" step="0.1" min="0" max="5" placeholder="Ví dụ: 4.5" required>
                    </div>

                    <div class="form-group">
                        <label for="reviewCount">Số lượng đánh giá:</label>
                        <input type="number" id="reviewCount" name="reviewCount" class="form-control" min="0" placeholder="Ví dụ: 55200">
                    </div>

                    <h2 class="section-title">Danh mục, Nền tảng & Yêu cầu</h2>

                    <div class="form-group">
                        <label>Thể loại (Genres - Chọn nhiều):</label>
                        <div class="checkbox-group" id="genre-checkbox-group">
                            <!-- Các checkbox sẽ được tạo bằng JS -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Nền tảng (Platforms - Chọn nhiều):</label>
                        <div class="checkbox-group" id="platform-checkbox-group">
                            <!-- Các checkbox sẽ được tạo bằng JS -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Cần kết nối mạng (Requires Internet):</label>
                        <div class="radio-group">
                            <div class="checkbox-item">
                                <input type="radio" id="internetYes" name="requiresInternet" value="true" required>
                                <label for="internetYes">CÓ</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="internetNo" name="requiresInternet" value="false">
                                <label for="internetNo">KHÔNG</label>
                            </div>
                        </div>
                    </div>

                    <h2 class="section-title">Nội dung & Media</h2>

                    <div class="form-group">
                        <label for="description">Mô tả chi tiết (Description):</label>
                        <textarea id="description" name="description" class="form-control" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="features">Tính năng chính (Features - Mỗi dòng là một tính năng):</label>
                        <textarea id="features" name="features" class="form-control" placeholder="Ví dụ: Lối chơi MOBA chiến thuật 5v5 cổ điển. Mỗi tính năng một dòng."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="trailerLink">Link Trailer (YouTube Embed):</label>
                        <input type="url" id="trailerLink" name="trailer" class="form-control" placeholder="https://www.youtube.com/embed/...">
                    </div>

                    <div class="form-group">
                        <label for="thumbnailLink">Link Ảnh Thumbnail (Ảnh đại diện):</label>
                        <input type="url" id="thumbnailLink" name="thumbnail" class="form-control" required placeholder="https://image.com/thumbnail.jpg">
                    </div>

                    <div class="form-group">
                        <label for="screenshots">Link Screenshots (Ảnh game - Mỗi dòng là một link ảnh):</label>
                        <textarea id="screenshots" name="screenshots" class="form-control" placeholder="https://image.com/ss1.jpg\nhttps://image.com/ss2.jpg. Mỗi link một dòng."></textarea>
                    </div>

                    <h2 class="section-title">Thông tin bổ sung</h2>

                    <div class="form-group">
                        <label for="gameSize">Kích thước Game (Size):</label>
                        <input type="text" id="gameSize" name="size" class="form-control" placeholder="Ví dụ: 50 GB">
                    </div>

                    <div class="form-group">
                        <label for="gameDownloads">Số lượng Tải xuống (Downloads):</label>
                        <input type="text" id="gameDownloads" name="downloads" class="form-control" placeholder="Ví dụ: 500M+">
                    </div>

                    <div class="form-group">
                        <label for="updateDate">Ngày Cập nhật gần nhất:</label>
                        <input type="text" id="updateDate" name="updateDate" class="form-control" placeholder="Ví dụ: 01/12/2025">
                    </div>

                    <div class="form-group">
                        <label for="cardUrl">Link Ảnh Thẻ (Card URL):</label>
                        <input type="url" id="cardUrl" name="cardUrl" class="form-control" placeholder="https://image.com/card.jpg">
                    </div>

                    <div class="form-group">
                        <label for="hotEvent">Link Ảnh Sự kiện Nổi bật (Hot Event):</label>
                        <input type="url" id="hotEvent" name="hotEvent" class="form-control" placeholder="https://image.com/event.jpg">
                    </div>

                    <div class="form-group">
                        <label for="promoUrl">Link Ảnh Quảng bá (URL):</label>
                        <input type="url" id="promoUrl" name="url" class="form-control" placeholder="https://image.com/promo.jpg">
                    </div>

                    <div class="form-group">
                        <label for="detailLink">Link Chi tiết Game (Link):</label>
                        <input type="text" id="detailLink" name="link" class="form-control" placeholder="Ví dụ: game_detail_template.html?id=1">
                    </div>


                    <h2 class="section-title">Cấu hình hệ thống (Config)</h2>
                    
                    <div class="config-grid">
                        <div class="config-box">
                            <h3 style="color: #ffd700;">Tối thiểu (Min)</h3>
                            <div class="form-group">
                                <label for="minCpu">CPU:</label>
                                <input type="text" id="minCpu" name="config.min.CPU" class="form-control" placeholder="Intel Core i3-530">
                            </div>
                            <div class="form-group">
                                <label for="minRam">RAM:</label>
                                <input type="text" id="minRam" name="config.min.RAM" class="form-control" placeholder="2 GB">
                            </div>
                            <div class="form-group">
                                <label for="minGpu">Card đồ họa:</label>
                                <input type="text" id="minGpu" name="config.min.Card đồ họa" class="form-control" placeholder="NVIDIA GeForce 9600GT">
                            </div>
                            <div class="form-group">
                                <label for="minOs">HĐH:</label>
                                <input type="text" id="minOs" name="config.min.HĐH" class="form-control" placeholder="Windows 7/8/10">
                            </div>
                            <div class="form-group">
                                <label for="minStorage">Dung lượng:</label>
                                <input type="text" id="minStorage" name="config.min.Dung lượng" class="form-control" placeholder="16 GB HDD">
                            </div>
                        </div>

                        <div class="config-box">
                            <h3 style="color: #4CAF50;">Đề nghị (Rec)</h3>
                            <div class="form-group">
                                <label for="recCpu">CPU:</label>
                                <input type="text" id="recCpu" name="config.rec.CPU" class="form-control" placeholder="Intel Core i5-750">
                            </div>
                            <div class="form-group">
                                <label for="recRam">RAM:</label>
                                <input type="text" id="recRam" name="config.rec.RAM" class="form-control" placeholder="4 GB">
                            </div>
                            <div class="form-group">
                                <label for="recGpu">Card đồ họa:</label>
                                <input type="text" id="recGpu" name="config.rec.Card đồ họa" class="form-control" placeholder="NVIDIA GeForce GTX 560">
                            </div>
                            <div class="form-group">
                                <label for="recOs">HĐH:</label>
                                <input type="text" id="recOs" name="config.rec.HĐH" class="form-control" placeholder="Windows 10 64-bit">
                            </div>
                            <div class="form-group">
                                <label for="recStorage">Dung lượng:</label>
                                <input type="text" id="recStorage" name="config.rec.Dung lượng" class="form-control" placeholder="16 GB SSD">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit" id="submit-btn">LƯU GAME (Thêm mới/Cập nhật)</button>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL TÙY CHỈNH (Thay thế alert/confirm) -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon"></div>
            <h3 id="modal-title"></h3>
            <p id="modal-message"></p>
            <div class="modal-buttons" id="modal-buttons">
                <!-- Buttons sẽ được thêm vào đây -->
            </div>
        </div>
    </div>

    <!-- Script JavaScript Nhúng -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ once: true, duration: 800 });
        
        // --- CẤU HÌNH API VÀ DỮ LIỆU ---
        const BIN_ID = '6935590d43b1c97be9dd6572';
        const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        const API_KEY = '$2a$10$dAGf830CRlXglDv0cce8IOz5ayJDKDIW8.uPxvWVXMgR7Wm.UG.7G'; // Master Key
        
        let allGamesData = [];

        // Dữ liệu Game Fortnite mặc định (dùng để khởi tạo nếu API trống)
        const fortniteGameData = {
            "id": 1,
            "name": "Fortnite",
            "developer": "Epic Games",
            "releaseDate": "25/07/2017",
            "officialWebsite": "https://www.epicgames.com/fortnite",
            "downloadText": "⬇ Tải Game Miễn Phí (PC/Console/Mobile)",
            "rating": 4.5,
            "reviewCount": 55200,
            "genres": [
                "Hành động",
                "Battle Royale",
                "Sinh tồn",
                "Online"
            ],
            "platforms": [
                "PC",
                "PlayStation",
                "Xbox",
                "Mobile"
            ],
            "requiresInternet": true,
            "description": "Fortnite là một trò chơi điện tử sinh tồn Battle Royale miễn phí, được phát triển bởi Epic Games. Người chơi tham gia vào một trận chiến sinh tử với 100 người khác trên một hòn đảo rộng lớn. Game nổi bật với cơ chế xây dựng độc đáo, cho phép người chơi tạo ra các công trình phòng thủ và tấn công.",
            "features": [
                "Chế độ Battle Royale cho 100 người.",
                "Cơ chế xây dựng độc đáo, thêm chiều sâu chiến thuật.",
                "Hệ thống skin và vật phẩm thẩm mỹ đa dạng (Thẻ Battle Pass).",
                "Cập nhật thường xuyên với các sự kiện và mùa giải mới.",
                "Có thể chơi trên nhiều nền tảng (Cross-platform play)."
            ],
            "trailer": "https://www.youtube.com/embed/Xu3WYDFhB_Y?si=RPud7TsBVYW9L07",
            "thumbnail": "https://cdn2.unrealengine.com/ecosystem-w-fn-1920x1080-6d0b8c3e74ff.jpg",
            "screenshots": [
                "https://cdn2.unrealengine.com/rectangle-7529303-475x269-10a470d3e03b.png",
                "https://cdn2.unrealengine.com/rectangle-7529304-475x269-4d929945de24.png",
                "https://cdn2.unrealengine.com/cdn-uploader-FNBR_39-00_C7S1_BR_DiscoverPlaylistTile__1920x1080-1920x1080-c1677e34.jpg",
                "https://cms-assets.unrealengine.com/cm6l5gfpm05kr07my04cqgy2x/cmhc4tb6o12x707n4v9vuvn9q",
                "https://gamelade.vn/wp-content/uploads/2024/11/fortnite-1-1_11zon.jpg",
                "https://gomobi.vn/home/images/screenshot/1458718997_unnamed-2.jpeg",
                "https://gomobi.vn/home/images/screenshot/1458718997_unnamed-3.jpeg",
                "https://gomobi.vn/home/images/screenshot/1458718997_unnamed-4.jpeg",
                "https://gomobi.vn/home/images/screenshot/1458719009_unnamed-5.jpeg"
            ],
            "config": {
                "min": {
                    "CPU": "Core i3-3225 3.3 GHz",
                    "RAM": "8 GB",
                    "Card đồ họa": "Intel HD 4000 / AMD Radeon Vega 8",
                    "HĐH": "Windows 7/8/10 64-bit",
                    "Dung lượng": "26 GB HDD"
                },
                "rec": {
                    "CPU": "Core i5-7300U 3.5 GHz",
                    "RAM": "16 GB",
                    "Card đồ họa": "NVIDIA GTX 960 / AMD R9 280 trở lên",
                    "HĐH": "Windows 10 64-bit",
                    "Dung lượng": "26 GB SSD"
                }
            },
            "size": "50 GB",
            "downloads": "500M+",
            "updateDate": "01/12/2025",
            "cardUrl": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRls92oO4Eh-3ZGV7ogLhzToIFB1Bhy5wYU9FvHIxi_wAeq24Q3cZu-Q6ssoZ2EQ8xp02qlL922bLTQoNr3BFwmayxuI1Pd6ugoO8-kJQ&s=10",
            "hotEvent": "https://cafefcdn.com/thumb_w/640/203337114487263232/2025/12/6/photo1765002559570-1765002559865188981854-1765003518830112687538.jpg",
            "url": "https://cdn2.unrealengine.com/fneco-2025-keyart-thumb-1920x1080-de84aedabf4d.jpg",
            "link": "game_detail_template.html?id=1"
        };


        // Tất cả các giá trị thể loại và nền tảng có thể có
        const ALL_GENRES = ["Hành động", "Phiêu lưu", "Thể thao", "Chiến thuật", "MOBA", "MMORPG", "Thế giới mở", "Sáng tạo", "Cày cuốc", "Battle Royale", "Action RPG", "Sinh tồn", "Online"];
        const ALL_PLATFORMS = ["PC", "PlayStation", "Xbox", "Mobile", "Android", "iOS", "Console", "Java", "PS4/5"];

        // --- HÀM MODAL TÙY CHỈNH (THAY THẾ alert/confirm) ---

        /**
         * Hiển thị Modal tùy chỉnh (Alert hoặc Confirm).
         * @param {string} type - 'alert' hoặc 'confirm'.
         * @param {string} title - Tiêu đề Modal.
         * @param {string} message - Nội dung thông báo.
         * @param {function} onConfirm - Callback khi người dùng xác nhận (chỉ dùng cho 'confirm').
         */
        function showCustomModal(type, title, message, onConfirm = null) {
            const modal = document.getElementById('customModal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalButtons = document.getElementById('modal-buttons');
            const modalIcon = document.getElementById('modal-icon');

            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalButtons.innerHTML = '';
            
            // Hàm đóng Modal
            const closeModal = () => {
                modal.classList.remove('show');
                // Xóa các event listener cũ để tránh rò rỉ bộ nhớ
                modalButtons.innerHTML = ''; 
            };

            if (type === 'alert') {
                modalIcon.innerHTML = '<i class="fa-solid fa-circle-check" style="color: #4CAF50;"></i>';
                const okBtn = document.createElement('button');
                okBtn.className = 'modal-btn btn-ok';
                okBtn.textContent = 'Đã hiểu';
                okBtn.onclick = closeModal;
                modalButtons.appendChild(okBtn);
            } else if (type === 'error') {
                modalIcon.innerHTML = '<i class="fa-solid fa-circle-exclamation" style="color: #f44336;"></i>';
                const okBtn = document.createElement('button');
                okBtn.className = 'modal-btn btn-ok';
                okBtn.textContent = 'Đóng';
                okBtn.onclick = closeModal;
                modalButtons.appendChild(okBtn);
            } else if (type === 'confirm') {
                modalIcon.innerHTML = '<i class="fa-solid fa-triangle-exclamation" style="color: #f7931e;"></i>';
                
                // Nút Xác nhận
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'modal-btn btn-confirm-delete';
                confirmBtn.textContent = 'Xóa Vĩnh Viễn';
                confirmBtn.onclick = () => {
                    closeModal();
                    if (onConfirm) onConfirm();
                };
                
                // Nút Hủy
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'modal-btn btn-cancel';
                cancelBtn.textContent = 'Hủy';
                cancelBtn.onclick = closeModal;

                modalButtons.appendChild(cancelBtn);
                modalButtons.appendChild(confirmBtn);
            }

            modal.classList.add('show');
        }


        // --- HÀM GỌI API (THAY THẾ BẰNG LOGIC THỰC TẾ TRONG ỨNG DỤNG CỦA BẠN) ---

        /**
         * Lấy dữ liệu game từ JSONBin.io.
         */
        async function fetchGamesData() {
            const loadingMessage = document.getElementById('loading-message');
            loadingMessage.style.display = 'block';
            
            try {
                // Sử dụng /latest để lấy bản ghi mới nhất
                const response = await fetch(`${API_URL}/latest`, {
                    method: 'GET',
                    headers: { 'X-Master-Key': API_KEY }
                });

                if (!response.ok) {
                    throw new Error(`Lỗi HTTP: ${response.status}`);
                }

                const data = await response.json();
                // Dữ liệu thực tế nằm trong trường 'record'
                allGamesData = data.record || []; 
                console.log("Dữ liệu game đã tải:", allGamesData.length);

                // LOGIC BỔ SUNG: Nếu dữ liệu trống, khởi tạo với game mẫu (Fortnite)
                if (allGamesData.length === 0) {
                    console.log("Dữ liệu trống. Đang khởi tạo với game mẫu...");
                    allGamesData = [fortniteGameData];
                    // Gửi dữ liệu khởi tạo này lên API
                    await updateGamesData(allGamesData); 
                    showCustomModal('alert', 'Khởi tạo Dữ liệu Thành Công', 'API rỗng, đã khởi tạo với dữ liệu game Fortnite. Vui lòng nhấn Quay lại Danh sách để tải lại.');
                }

            } catch (error) {
                console.error('Lỗi khi tải dữ liệu Game:', error);
                allGamesData = []; // Đặt mảng trống nếu có lỗi
                showCustomModal('error', 'Lỗi Tải Dữ Liệu', 'Không thể tải dữ liệu game từ API. Vui lòng kiểm tra kết nối mạng và Console log.');
            } finally {
                loadingMessage.style.display = 'none';
                renderGameList();
            }
        }
        
        /**
         * Gửi dữ liệu cập nhật lên JSONBin.io (PUT)
         * @param {object} updatedData - Mảng game đã được cập nhật
         */
        async function updateGamesData(updatedData) {
            console.log("Đang gửi dữ liệu cập nhật (PUT)...");
            try {
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY,
                        'X-Bin-Versioning': 'false' // Quan trọng: Tắt versioning để dễ quản lý hơn
                    },
                    body: JSON.stringify(updatedData)
                });

                if (!response.ok) {
                    throw new Error(`Lỗi HTTP khi cập nhật: ${response.status}`);
                }
                
                const result = await response.json();
                console.log("Cập nhật thành công:", result);
                return true;

            } catch (error) {
                console.error('Lỗi khi cập nhật dữ liệu:', error);
                showCustomModal('error', 'Lỗi Lưu Dữ Liệu', 'Lỗi: Không thể lưu thay đổi vào API. Kiểm tra console.');
                return false;
            }
        }

        // --- HÀM QUẢN LÝ VIEW ---

        /**
         * Chuyển đổi giữa chế độ 'list' và 'form'.
         * @param {string} view - 'list' hoặc 'form'.
         */
        function switchView(view) {
            const listView = document.getElementById('listView');
            const formView = document.getElementById('formView');

            if (view === 'list') {
                listView.classList.add('active');
                formView.classList.remove('active');
                fetchGamesData(); // Tải lại danh sách khi quay lại
            } else if (view === 'form') {
                listView.classList.remove('active');
                formView.classList.add('active');
            }
        }

        // --- HÀM DANH SÁCH GAME ---

        /**
         * Tạo thẻ Game Card cho danh sách.
         * @param {object} game - Đối tượng game.
         */
        function createGameCard(game) {
            const delay = (game.id % 8) * 100;
            return `
                <div class="game-card" 
                    data-id="${game.id}" 
                    data-aos="fade-up"               
                    data-aos-delay="${delay}">      
                    <div class="game-image">
                        <img src="${game.thumbnail}" alt="${game.name}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/333/fff?text=No+Image'">
                    </div>
                    <div class="game-content">
                        <div>
                            <h3 class="game-title">${game.name}</h3>
                            <p class="game-category">${(game.genres || []).join(' • ')}</p>
                            <p class="game-rating">
                                <i class="fa-solid fa-star"></i> ${(game.rating || 0).toFixed(1)}
                            </p>
                        </div>
                        <button class="btn-edit" onclick="event.stopPropagation(); loadGameForm(${game.id})">
                            <i class="fa-solid fa-pen"></i> Sửa
                        </button>
                    </div>
                </div>
            `;
        }
        
        /**
         * Render danh sách game ra màn hình.
         */
        function renderGameList() {
            const gameListContainer = document.getElementById('gameList');
            const noResultsDiv = document.getElementById('noResults');
            
            if (allGamesData.length === 0) {
                gameListContainer.innerHTML = '';
                noResultsDiv.style.display = 'block';
                return;
            }

            const filteredGames = allGamesData.filter(game => true); 
            
            gameListContainer.innerHTML = filteredGames.map(createGameCard).join('');
            noResultsDiv.style.display = filteredGames.length === 0 ? 'block' : 'none';
            
            if (typeof AOS !== 'undefined') {
                AOS.refresh();
            }
        }

        // --- HÀM FORM CHỈNH SỬA / THÊM MỚI ---
        
        /**
         * Tạo các checkbox cho Form (Thể loại/Nền tảng).
         */
        function createCheckboxes(allOptions, selectedOptions, name, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = allOptions.map(option => {
                const isChecked = (selectedOptions || []).includes(option) ? 'checked' : '';
                const id = `${name}-${option.replace(/\s/g, '_').replace(/[^a-zA-Z0-9]/g, '')}`; 
                return `
                    <div class="checkbox-item">
                        <input type="checkbox" id="${id}" name="${name}" value="${option}" ${isChecked}>
                        <label for="${id}">${option}</label>
                    </div>
                `;
            }).join('');
        }

        /**
         * Tải dữ liệu Game vào Form hoặc khởi tạo Form trống.
         */
        function loadGameForm(gameId) {
            const form = document.getElementById('gameForm');
            const formTitle = document.getElementById('form-mode-title');
            const deleteButton = document.getElementById('delete-game-btn');
            const submitButton = document.getElementById('submit-btn');
            const gameData = gameId ? allGamesData.find(g => g.id === gameId) : null;

            form.reset(); 
            
            if (gameData) {
                // CHẾ ĐỘ SỬA
                formTitle.textContent = `CHỈNH SỬA GAME ID: ${gameId}`;
                submitButton.textContent = 'CẬP NHẬT GAME';
                deleteButton.disabled = false;
                deleteButton.classList.add('active');

                // Điền dữ liệu vào các trường Input/Textarea cơ bản
                document.getElementById('gameId').value = gameData.id;
                document.getElementById('gameName').value = gameData.name || '';
                document.getElementById('developer').value = gameData.developer || '';
                document.getElementById('releaseDate').value = gameData.releaseDate || '';
                document.getElementById('officialWebsite').value = gameData.officialWebsite || '';
                document.getElementById('downloadText').value = gameData.downloadText || '';
                document.getElementById('rating').value = gameData.rating || 0;
                document.getElementById('reviewCount').value = gameData.reviewCount || 0;
                document.getElementById('description').value = gameData.description || '';
                document.getElementById('features').value = (gameData.features || []).join('\n');
                document.getElementById('trailerLink').value = gameData.trailer || '';
                document.getElementById('thumbnailLink').value = gameData.thumbnail || '';
                document.getElementById('screenshots').value = (gameData.screenshots || []).join('\n');
                
                // Điền dữ liệu bổ sung mới
                document.getElementById('gameSize').value = gameData.size || '';
                document.getElementById('gameDownloads').value = gameData.downloads || '';
                document.getElementById('updateDate').value = gameData.updateDate || '';
                document.getElementById('cardUrl').value = gameData.cardUrl || '';
                document.getElementById('hotEvent').value = gameData.hotEvent || '';
                document.getElementById('promoUrl').value = gameData.url || ''; // Ánh xạ trường 'url'
                document.getElementById('detailLink').value = gameData.link || ''; // Ánh xạ trường 'link'


                // Điền dữ liệu Cấu hình (Config)
                const min = gameData.config?.min || {};
                const rec = gameData.config?.rec || {};
                document.getElementById('minCpu').value = min.CPU || '';
                document.getElementById('minRam').value = min.RAM || '';
                document.getElementById('minGpu').value = min['Card đồ họa'] || '';
                document.getElementById('minOs').value = min.HĐH || '';
                document.getElementById('minStorage').value = min['Dung lượng'] || '';
                document.getElementById('recCpu').value = rec.CPU || '';
                document.getElementById('recRam').value = rec.RAM || '';
                document.getElementById('recGpu').value = rec['Card đồ họa'] || '';
                document.getElementById('recOs').value = rec.HĐH || '';
                document.getElementById('recStorage').value = rec['Dung lượng'] || '';
                
                // Chọn Radio (Cần mạng)
                const requiresInternet = gameData.requiresInternet === true || gameData.requiresInternet === 'true';
                const internetRadio = document.getElementById(requiresInternet ? 'internetYes' : 'internetNo');
                if (internetRadio) internetRadio.checked = true;

                // Tạo và chọn Checkbox
                createCheckboxes(ALL_GENRES, gameData.genres, 'genres', 'genre-checkbox-group');
                createCheckboxes(ALL_PLATFORMS, gameData.platforms, 'platforms', 'platform-checkbox-group');

            } else {
                // CHẾ ĐỘ THÊM MỚI
                formTitle.textContent = 'THÊM GAME MỚI';
                submitButton.textContent = 'LƯU GAME MỚI';
                deleteButton.disabled = true;
                deleteButton.classList.remove('active');
                document.getElementById('gameId').value = ''; 
                
                // Mặc định cần mạng là CÓ khi thêm mới
                document.getElementById('internetYes').checked = true;

                // Tạo Checkbox trống
                createCheckboxes(ALL_GENRES, [], 'genres', 'genre-checkbox-group');
                createCheckboxes(ALL_PLATFORMS, [], 'platforms', 'platform-checkbox-group');
            }

            switchView('form'); // Hiển thị Form View
        }

        /**
         * Logic Xóa Game.
         */
        async function deleteGameLogic() {
            const gameId = parseInt(document.getElementById('gameId').value);
            if (!gameId) return;
            
            const newGamesData = allGamesData.filter(g => g.id !== gameId);

            if (await updateGamesData(newGamesData)) {
                allGamesData = newGamesData; // Cập nhật mảng local sau khi API thành công
                showCustomModal('alert', 'Xóa Game Thành Công', `Đã xóa Game ID: ${gameId} thành công.`);
                switchView('list');
            }
        }
        
        /**
         * Xóa Game khỏi mảng và cập nhật API.
         */
        function handleDelete(event) {
            const gameId = parseInt(document.getElementById('gameId').value);
            if (!gameId || event.target.disabled) return;
            
            // Sử dụng modal tùy chỉnh để xác nhận xóa
            showCustomModal(
                'confirm', 
                'Xác Nhận Xóa Game', 
                `Bạn có chắc chắn muốn xóa Game ID: ${gameId} không? Hành động này không thể hoàn tác.`,
                deleteGameLogic // Truyền logic xóa game vào callback xác nhận
            );
        }
        
        /**
         * Xử lý Submit Form (Lưu/Cập nhật Game)
         */
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const data = {};
            const formData = new FormData(form);
            
            // Thu thập và xử lý dữ liệu form
            formData.forEach((value, key) => {
                if (key === 'genres' || key === 'platforms') {
                    if (!data[key]) {
                        data[key] = [];
                    }
                    data[key].push(value);
                } else if (key.startsWith('config.')) {
                    const parts = key.split('.');
                    if (!data.config) data.config = {};
                    if (!data.config[parts[1]]) data.config[parts[1]] = {};
                    // Lấy ra tên cấu hình (VD: CPU, RAM)
                    const configKey = parts[2]; 
                    data.config[parts[1]][configKey] = value;
                } else {
                    data[key] = value;
                }
            });

            // Xử lý các trường multi-line (features và screenshots)
            data.features = (data.features || '').split('\n').map(s => s.trim()).filter(s => s.length > 0);
            data.screenshots = (data.screenshots || '').split('\n').map(s => s.trim()).filter(s => s.length > 0);
            
            // Ép kiểu
            const isEditing = !!data.id;
            // Tạo ID mới lớn hơn ID lớn nhất hiện có + 1
            data.id = isEditing ? parseInt(data.id, 10) : Math.max(0, ...allGamesData.map(g => g.id)) + 1; 
            data.rating = parseFloat(data.rating) || 0;
            data.reviewCount = parseInt(data.reviewCount, 10) || 0;
            data.requiresInternet = data.requiresInternet === 'true';

            // Cập nhật mảng dữ liệu local
            let newGamesData;
            if (isEditing) {
                // Sửa game đã có
                newGamesData = allGamesData.map(g => g.id === data.id ? data : g);
            } else {
                // Thêm mới game
                newGamesData = [...allGamesData, data];
            }

            // Gửi lên API
            if (await updateGamesData(newGamesData)) {
                allGamesData = newGamesData; // Cập nhật mảng local sau khi API thành công
                showCustomModal('alert', 'Lưu Game Thành Công', `${isEditing ? 'Cập nhật' : 'Thêm mới'} Game ID: ${data.id} thành công.`);
                switchView('list');
            }
        }

        // --- KHỞI TẠO ỨNG DỤNG ---
        document.addEventListener('DOMContentLoaded', () => {
            // Gán sự kiện cho Form
            document.getElementById('gameForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('delete-game-btn').addEventListener('click', handleDelete);

            // Bắt đầu bằng việc tải và hiển thị danh sách game
            fetchGamesData(); 
        });
    </script>

          <div id="footer-placeholder"></div>
            <script src="assets/js/loadHtml.js"></script>
    <script>
        loadHTML('footer.html', 'footer-placeholder');
    </script>
</body>

</html>